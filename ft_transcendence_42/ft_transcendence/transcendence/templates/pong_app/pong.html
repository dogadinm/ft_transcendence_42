{% extends "pong_app/layout.html" %}
{% block body %}
<head>
    <title>Multiplayer Pong</title>
    <style>
        canvas { background: #000; display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const roomName = prompt("Enter room name:");
const socket = new WebSocket(`ws://${window.location.host}/ws/game/${roomName}/`);

let paddleY1 = 150;
let paddleY2 = 150;
let playerSide = null;

socket.onopen = function() {
    console.log("Connected to the game room:", roomName);
};

socket.onmessage = function(event) {
    const data = JSON.parse(event.data);
    const { paddles, ball, score } = data;

    paddleY1 = paddles.left.paddleY;
    paddleY2 = paddles.right.paddleY;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = 'white';
    ctx.fillRect(10, paddleY1, 10, 100);
    ctx.fillRect(780, paddleY2, 10, 100);

    ctx.beginPath();
    ctx.arc(ball.x, ball.y, 10, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText(`Player 1: ${score.player1}`, 20, 20);
    ctx.fillText(`Player 2: ${score.player2}`, 650, 20);
};

document.addEventListener('keydown', (e) => {
    if (playerSide === null) {
        if (e.key === 'w') paddleY1 -= 10;
        if (e.key === 's') paddleY1 += 10;
        if (e.key === 'ArrowUp') paddleY2 -= 10;
        if (e.key === 'ArrowDown') paddleY2 += 10;

        socket.send(JSON.stringify({ side: 'left', paddleY: paddleY1 }));
        socket.send(JSON.stringify({ side: 'right', paddleY: paddleY2 }));
    }
});


    </script>
</body>
</html>
{% endblock %}