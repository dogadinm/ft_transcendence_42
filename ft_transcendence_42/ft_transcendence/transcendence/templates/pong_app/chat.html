{% extends "pong_app/layout.html" %}

{% block body %}

<h1>Let's Chat</h1>


<ul>
    {% for l in list_f %}
    <li>
        <h2>{{ l }}</h2>
    </li>
    {% endfor %}
</ul>
<h2>Who</h2>
<form id="who-form">
    <input type="text" id="who-input" name="who" placeholder="Enter username" required />
    <button type="submit">Add friend</button>
</form>


<h2>Chat</h2>
<form id="message-form">
    <input type="text" id="message-input" name="message" placeholder="Enter your message" required />
    <button type="submit">Send</button>
</form>


<div id="messages"></div>

<script type="text/javascript">

    const url = `ws://${window.location.host}/ws/socet-server/`;
    const chatSocket = new WebSocket(url);


    chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        console.log('Data:', data);

        if (data.type === 'chat') {
            const messages = document.getElementById('messages');
            messages.insertAdjacentHTML(
                'beforeend',
                `<div><p><strong>${data.username}:</strong> ${data.message}</p></div>`
            );
        }
    };


    const whoForm = document.getElementById('who-form');
    whoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const whoInput = document.getElementById('who-input').value;

        chatSocket.send(
            JSON.stringify({
                who: whoInput,
            })
        );

        whoForm.reset();
    });


    const messageForm = document.getElementById('message-form');
    messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const messageInput = document.getElementById('message-input').value;

        chatSocket.send(
            JSON.stringify({
                message: messageInput,
            })
        );

        messageForm.reset();
    });
</script>

{% endblock %}